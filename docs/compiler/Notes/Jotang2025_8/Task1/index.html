<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-compiler/Notes/Jotang2025_8/Task1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Task1 | Koki&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Koki-Niwa.github.io/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Task1 | Koki&#x27;s Blog"><meta data-rh="true" name="description" content="本文档包含："><meta data-rh="true" property="og:description" content="本文档包含："><link data-rh="true" rel="icon" href="/Koki-s-Blog/img/logo2.png"><link data-rh="true" rel="canonical" href="https://Koki-Niwa.github.io/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1"><link data-rh="true" rel="alternate" href="https://Koki-Niwa.github.io/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1" hreflang="en"><link data-rh="true" rel="alternate" href="https://Koki-Niwa.github.io/Koki-s-Blog/zh-CN/docs/compiler/Notes/Jotang2025_8/Task1" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://Koki-Niwa.github.io/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Task1","item":"https://Koki-Niwa.github.io/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1"}]}</script><link rel="alternate" type="application/rss+xml" href="/Koki-s-Blog/blog/rss.xml" title="Koki&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Koki-s-Blog/blog/atom.xml" title="Koki&#39;s Blog Atom Feed"><link rel="stylesheet" href="/Koki-s-Blog/assets/css/styles.3cf59fac.css">
<script src="/Koki-s-Blog/assets/js/runtime~main.1fe9e421.js" defer="defer"></script>
<script src="/Koki-s-Blog/assets/js/main.0025ea46.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Koki-s-Blog/img/logo2.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Koki-s-Blog/"><div class="navbar__logo"><img src="/Koki-s-Blog/img/logo2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Koki-s-Blog/img/logo2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Koki</b></a><a class="navbar__item navbar__link" href="/Koki-s-Blog/docs/intro/">Intro</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Koki-s-Blog/docs/compiler/Intro">Compiler</a><a class="navbar__item navbar__link" href="/Koki-s-Blog/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/Koki-s-Blog/zh-CN/docs/compiler/Notes/Jotang2025_8/Task1" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">简体中文</a></li></ul></div><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Koki-s-Blog/docs/compiler/Intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Koki-s-Blog/docs/compiler/Notes/NotesIntro">Notes</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Koki-s-Blog/docs/compiler/Notes/NotesIntro">NotesIntro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/第八题介绍">Jotang2025_8</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/第八题介绍">第八题介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task0">Task0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task1">Task1</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Koki-s-Blog/docs/compiler/Class/ClassIntro">Class</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Koki-s-Blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Notes</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Jotang2025_8</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Task1</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Task1</h1></header><p>本文档包含：
1.对词法分析器，语法分析器，flex，Bison，文法等的初步了解
2.实现计算器的过程</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="词法分析器">词法分析器<a href="#词法分析器" class="hash-link" aria-label="Direct link to 词法分析器" title="Direct link to 词法分析器">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="正则表达式">正则表达式<a href="#正则表达式" class="hash-link" aria-label="Direct link to 正则表达式" title="Direct link to 正则表达式">​</a></h3>
<p>s：
描述字符串匹配规则的“语言”
比如 c.t 表示所有以c开头，t结尾的三位字符串</p>
<p>主流的编译器采用<strong>有限自动机</strong>的思想来构造词法分析器</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="有限自动机">有限自动机<a href="#有限自动机" class="hash-link" aria-label="Direct link to 有限自动机" title="Direct link to 有限自动机">​</a></h3>
<p>chatGPT：
有限自动机就像一个<strong>小机器</strong>，它有：</p>
<ul>
<li><strong>有限个状态</strong>（就像几间房间，数量是有限的）</li>
<li><strong>一个起始状态</strong>（你一开始在哪个房间）</li>
<li><strong>一些接受状态</strong>（如果你最后停在这里，就算“成功”）</li>
<li><strong>状态转移规则</strong>（读到某个输入字符时，从一个房间走到另一个房间）</li>
</ul>
<p>它用来<strong>处理一个字符串</strong>：</p>
<ul>
<li>从起始状态开始，逐个读字符</li>
<li>按照转移规则改变状态</li>
<li>最后如果停在接受状态，就说这个字符串被“接受”；否则不接受。</li>
</ul>
<p>比如我们要识别字符串 <code>&quot;ab&quot;</code>。
我们可以设计一个有限自动机：</p>
<ul>
<li>
<p>状态集合：<code>{q0, q1, q2}</code></p>
</li>
<li>
<p>起始状态：<code>q0</code></p>
</li>
<li>
<p>接受状态：<code>q2</code></p>
</li>
<li>
<p>转移规则：</p>
<ul>
<li>在 <code>q0</code> 读到 <code>a</code> → 去 <code>q1</code></li>
<li>在 <code>q1</code> 读到 <code>b</code> → 去 <code>q2</code></li>
<li>其他情况 → 不动或者走到死路（拒绝）</li>
</ul>
</li>
</ul>
<p>这样：</p>
<ul>
<li>输入 <code>&quot;ab&quot;</code>：<code>q0 --a--&gt; q1 --b--&gt; q2</code> → 接受 ✅</li>
<li>输入 <code>&quot;a&quot;</code>：只到 <code>q1</code> 就结束 → 不接受 ❌</li>
<li>输入 <code>&quot;abc&quot;</code>：走到 <code>q2</code> 后还多一个 <code>c</code> → 不接受 ❌</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="为什么叫有限">为什么叫“有限”<a href="#为什么叫有限" class="hash-link" aria-label="Direct link to 为什么叫“有限”" title="Direct link to 为什么叫“有限”">​</a></h4>
<p>因为状态数目是有限的，不像程序可以无限开变量。
有限自动机的“记忆”能力就是：<strong>只能通过“状态”来记住过去的信息</strong>，它不能像栈、数组那样存储无限的历史。</p>
<p>例如：</p>
<ul>
<li>有限自动机能识别“是否含有偶数个 1”。</li>
<li>但它<strong>不能</strong>识别“括号是否匹配”，因为括号嵌套可能无限深，有限个状态记不住。</li>
</ul>
<p>在编译器中的应用</p>
<p>在编译器的 <strong>词法分析（lexical analysis）</strong> 阶段：</p>
<ul>
<li>用正则表达式定义“单词”的规则（比如标识符、数字、关键字等）。</li>
<li>再把正则表达式转换成有限自动机。</li>
<li>有限自动机负责“扫描源代码”，识别出一个个 token。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="为什么词法分析器需要有限自动机">为什么词法分析器需要有限自动机<a href="#为什么词法分析器需要有限自动机" class="hash-link" aria-label="Direct link to 为什么词法分析器需要有限自动机" title="Direct link to 为什么词法分析器需要有限自动机">​</a></h4>
<blockquote>
<p>“我写个程序扫描源代码，不就是按字符读、匹配关键字、分隔符、数字吗？干嘛要扯什么<strong>有限自动机</strong>这么抽象的东西？”</p>
</blockquote>
<p>原因主要有三点：
<strong>形式化描述，保证正确性</strong></p>
<p>编译器要处理的“单词”（token）种类非常多：关键字、标识符、整数、浮点数、字符串、注释……
如果你只凭直觉写 <code>if/else</code> 代码，容易遗漏或者写出一堆复杂的分支。</p>
<p><strong>有限自动机提供了一个精确的数学模型</strong>：</p>
<ul>
<li>“哪些字符串是合法的单词” → 用正则表达式描述</li>
<li>“如何一步一步识别” → 转换成有限自动机
这样就不怕有歧义或漏洞，保证 <strong>所有合法的输入都能被识别，非法的会被拒绝</strong>。</li>
</ul>
<p>s:
从正则表达式到有限自动机的过程
把字符串匹配、词法分析的过程规范化了</p>
<p>chatGPT：
以下是一个从正则表达式到有限自动机到字符串识别程序的例子（s进行了部分删改）</p>
<p>我们要识别 <strong>标识符</strong>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[a-z][a-z0-9]*</span><br></span></code></pre></div></div>
<p>意思是：</p>
<ul>
<li>第一个字符必须是小写字母</li>
<li>后面可以跟任意数量的小写字母或数字</li>
</ul>
<p>比如：<code>a</code>, <code>x1</code>, <code>abc123</code> ✅；
但 <code>1abc</code>, <code>_foo</code> ❌。</p>
<p><strong>正则表达式</strong></p>
<p>就是上面的写法：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[a-z][a-z0-9]*</span><br></span></code></pre></div></div>
<p>→ 描述了我们想要的字符串集合。</p>
<p>有限自动机（这里是DFA，也就是每一步都确定状态的自动机）：</p>
<ul>
<li>
<p>q0：开始状态</p>
<ul>
<li>输入 <code>[a-z]</code> → q1</li>
<li>输入其他 → 死状态</li>
</ul>
</li>
<li>
<p>q1：接受状态</p>
<ul>
<li>输入 <code>[a-z0-9]</code> → q1</li>
<li>输入其他 → 死状态</li>
</ul>
</li>
</ul>
<p><strong>词法分析器代码</strong></p>
<p>最后一步就是把（最小） DFA 写成代码。</p>
<p>比如 C 里可以写成状态机：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">scan_identifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// q0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// q0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token char">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token char">&#x27;z&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 非法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// q1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token char">&#x27;a&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token char">&#x27;z&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token char">&#x27;0&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token char">&#x27;9&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 非法字符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 是否在接受状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>输入 <code>&quot;abc123&quot;</code> → 返回 1（接受）
输入 <code>&quot;1abc&quot;</code> → 返回 0（拒绝）</p>
<p>s:
实际上我们最后写成的程序可以看作是在<strong>构建并维护一个有限自动机</strong>
在这个过程中会用到两种算法 Thompson算法和子集构造法</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="thmopson算法和子集构造法">Thmopson算法和子集构造法<a href="#thmopson算法和子集构造法" class="hash-link" aria-label="Direct link to Thmopson算法和子集构造法" title="Direct link to Thmopson算法和子集构造法">​</a></h4>
<p>s:
一般来讲，从正则表达式到字符串识别程序（词法分析器）需要经历几个步骤
正则表达式-&gt;NFA（非确定性有限自动机）-&gt;DFA（确定性有限自动机）-&gt;最小化DFA-&gt; 可用的字符串识别程序
<strong>Thompson算法</strong>是处理第一步 从正则表达式到NFA的
以下是Thompson算法的具体构造规则</p>
<p>chatGPT:</p>
<p>Thompson 算法的思路是把一个正则表达式（regular expression）一步步“组装成”一个 NFA（带 ε 转移的非确定性有限自动机，ε 表示不消耗输入的空转移），这样我们就能用自动机来做匹配。它由 Ken Thompson 在早期 Unix 工具的背景下提出——思想是把正则的三种基本运算（连接、并、星号）做成小片段，然后通过简单规则把片段拼起来。</p>
<p>以下是学习这个算法必须知道的概念：</p>
<ul>
<li>
<p><strong>正则表达式（regex）</strong>：用来描述字符串集合的式子，基本构造：</p>
<ul>
<li>单字符：<code>a</code> 表示 <!-- -->a<!-- -->。</li>
<li>连接（concatenation）：<code>AB</code> 表示先匹配 A 再匹配 B。</li>
<li>并/或（union/alternation）：<code>A|B</code> 表示 A 或 B。</li>
<li>克林闭包（Kleene star）：<code>A*</code> 表示 A 重复 0 次或多次。</li>
<li>括号 <code>(...)</code> 用来控制优先级。</li>
</ul>
</li>
<li>
<p><strong>语言 L(R)</strong>：正则 R 描述的所有字符串集合。</p>
</li>
<li>
<p><strong>有限自动机（finite automaton）</strong>：由若干状态（states）和标记为字母或 ε 的有向边（transitions）构成。一个初始状态（start）和一个或多个接受状态（accept）。机器按输入走边，最后落在接受状态则接受该字符串。</p>
</li>
<li>
<p><strong>NFA（非确定性有限自动机）</strong>：从某一状态在相同输入符号下可以有多条边可选（即“非确定”）。NFA 可以含有 <strong>ε（epsilon）边</strong>，表示不消耗输入就能从一个状态跳到另一个。</p>
</li>
<li>
<p><strong>DFA（确定性有限自动机）</strong>：对每个状态和每个输入符号，最多只有一条出边（确定的）。</p>
</li>
<li>
<p><strong>ε-闭包（epsilon-closure）</strong>：给定状态集合 S，ε-闭包是从 S 出发只沿 ε 边能到达的所有状态（包括 S 自身）。这是 NFA 模拟必需的概念。</p>
</li>
</ul>
<p><strong>Thompson 构造的核心规则（图示化说明）</strong></p>
<p>Thompson 的思想非常模块化：为最基本的正则构造（字符、连接、并、星）分别设计 NFA 片段（fragment），然后按表达式的语法树把片段组合起来。每个片段有<strong>唯一的开始状态</strong>和<strong>唯一的接受（终结）状态</strong>，组合后新的片段仍然满足这个属性。</p>
<p>接下来用图示来表示：
用 <code>→</code> 表示有向边，用 <code>-a-&gt;</code> 表示读字符 <code>a</code> 的转移，用 <code>-ε-&gt;</code> 表示 ε 转移（不消耗输入）。</p>
<ol>
<li><strong>字符 a 的片段</strong></li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(s) -a-&gt; (t)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start = s, accept = t</span><br></span></code></pre></div></div>
<ol start="2">
<li><strong>连接（concatenation） A B</strong>
把 A 的 accept 用 ε 连接到 B 的 start（或者把 A 的“悬挂出口”接到 B 的 start），整体 start=A.start，accept=B.accept。示意：</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A.start ... A.accept -ε-&gt; B.start ... B.accept</span><br></span></code></pre></div></div>
<ol start="3">
<li><strong>并（alternation） A|B</strong>
新建一个 start，两个 ε 分别指向 A.start 和 B.start；A.accept 和 B.accept 用 ε 指向一个新 accept：</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">         -ε-&gt; A.start ... A.accept -ε-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /                             \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newStart                               newAccept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        \                             /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         -ε-&gt; B.start ... B.accept -ε-</span><br></span></code></pre></div></div>
<ol start="4">
<li><strong>星号 A</strong>*
新建 start 和 accept：start 有 ε 指向 A.start 并且 ε 指向 accept（允许 0 次）；A.accept 有 ε 指回 A.start（循环）并且 ε 指向 accept（结束）。</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      -ε-&gt; A.start ... A.accept -ε-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     /                         \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newStart                         newAccept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     \-ε-----------------------&gt;/</span><br></span></code></pre></div></div>
<p>这保证了可以“跳过”A（0 次）或进入 A 再回到开始继续重复。</p>
<p>（<strong>派生</strong>：<code>A+</code> = <code>AA*</code>，<code>A?</code> = <code>A|ε</code>，可以用上面的规则组合得到。）</p>
<p>s:</p>
<p>NFA 的特点：
它有 ε-边（不读字符就能跳转），
对同一个输入字符可能有多个走向（非确定性）。
这对人类推理挺友好，但对计算机执行就不方便。
所以下一步要用 子集构造法 把 NFA 转成一个 等价的 DFA。</p>
<p><strong>子集构造法</strong>
s:
子集构造法有两个操作：
1.<strong>合点</strong>（用ε连接的点可以看作是一个点，也就可以合成为一点），这一步的得到的地位相同的点的集合被叫做ε-closure(S)，其中S是作为出发点的点的集合。
2.<strong>移动</strong>，从合成的点出发，经过可以经过的所有边，经过同一条边能到的点并入新的状态，这一步得到的被并入新状态的点的集合被叫做move(S, x)，其中S是作为出发点的点的集合，x是经过的边的名字</p>
<p>一下是一个具体例子，以便理解</p>
<p>(a|b)*a</p>
<p>先分析这个正则表达式
首先是a|b 表示a，b任选一个
对这个整体有* （闭包，我不懂为什么要这么翻译），表示这样的结构出现的次数大于等于0</p>
<p>然后根据Thompson法对每个结构逐步生成NFA
然后拼在一起</p>
<p>接着我们就可以使用子集构造法了</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">从0出发 合点，发现0，6，1，3，5，7地位相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">所以ε-closure({0})={0，1，3，5，6，7}，我们把它定为DFA的一个状态S0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">也就是说S0=ε-closure({0})={0，1，3，5，6，7}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">接下来 从 S0 对每个字母算move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">对a，发现1可以通过a到2，7可以通过a到8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">于是 move(S0,a)={2，8}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">同理 move(S0,b)={4}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">继续合点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">对{2，8}得到ε-closure({2，8})={1，2，3，4，5，6，7，8}，于是我们把它定为DFA的第二个状态S1，这个状态含有终点8，所以是DFA的接受态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">同理 ε-closure({4})={1，3，4，5，6，7}，记为S2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">接着  从 S1 对每个字母算move</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">move(S1, a) 注意到1→2，7→8，所以move(S1, a)={2，8}，而ε-closure({2，8})=S1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">也就是说 S1-a-&gt;S1，S1形成了自环 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">move(S1, b)={4}，而ε-closure({4})=S2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">故S1-b-&gt;S2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">move(S2, a)=S1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">得S2 --a--&gt; S1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">move(S2, b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">得S2 --b--&gt; S2（自环）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">若Sn对字母的转移没有像上面一样恰好映射到Sn中，则可能需要引入死状态∅</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">从而得到DFA  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> S0 = {6,1,3,5,7}--a--&gt; S1 = {1,2,3,5,6,7,8} (接受)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> S0 = {6,1,3,5,7}--b--&gt; S2 = {1,3,4,5,6,7}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   S1 --a--&gt; S1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   S1 --b--&gt; S2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   S2 --a--&gt; S1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   S2 --b--&gt; S2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>DFA最小化</strong></p>
<p>s:
上述方法得到的DFA可能有冗余状态
应该找到
逻辑上等价的一组状态，将其合并为一个状态
得到 最小 DFA</p>
<p>上述的S1和S2看似等价，然而S1是接受态，不可能等价
故上述DFA最小化的结果就是
S0 --a--&gt; S1<br>
<!-- -->S0 --b--&gt; S2
S1 --a--&gt; S1
S1 --b--&gt; S2
S2 --a--&gt; S1
S2 --b--&gt; S2
其中S1是接收状态</p>
<p><strong>带入模板得到目标程序</strong>
s:
上述DFA可表示为
delta[0]: a→1, b→2
delta[1]: a→1, b→2
delta[2]: a→1, b→2
以下是根据这个DFA生成的目标程序</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;string.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdbool.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">MAX_STATES</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">MAX_ALPH</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">128</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">// 支持 ASCII 字符作为输入符号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> num_states</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// 状态总数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> alphabet_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// 字母表大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> start_state</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// 初始状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool accept</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_STATES</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// 哪些是接受态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_STATES</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_ALPH</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 状态转移表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> DFA</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bool </span><span class="token function" style="color:#d73a49">dfa_accepts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DFA </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dfa</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> cur </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfa</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">start_state</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">size_t</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> sym </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> input</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sym </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> dfa</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">alphabet_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 超过字母表范围</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cur </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dfa</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cur</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">sym</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> dfa</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">accept</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cur</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ====== 示例： (a|b)*a ======</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 字母表: a=0, b=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DFA dfa</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">num_states </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alphabet_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// a, b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化接受态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> MAX_STATES</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accept</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">accept</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// state 1 是接受态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 填写转移表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 状态0: a→1, b→2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// b</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 状态1: a→1, b→2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 状态2: a→1, b→2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dfa</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">tests</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;b&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ba&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;abb&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aba&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;aaa&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tests</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> p</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%s -&gt; %s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dfa_accepts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dfa</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ACCEPT&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;REJECT&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>有了上述，也就有了编写编译器<strong>词法分析器</strong>基本思路</p>
<p>chatGPT：</p>
<p><strong>每种 token 写成一个正则表达式</strong></p>
<p>例如在 C 语言里：</p>
<ul>
<li>关键字：<code>if</code>、<code>while</code>、<code>for</code> … → 正则：<code>if|while|for</code></li>
<li>标识符：<code>[a-zA-Z_][a-zA-Z0-9_]*</code></li>
<li>整数：<code>[0-9]+</code></li>
<li>浮点数：<code>[0-9]+\.[0-9]+</code></li>
<li>运算符：<code>\+|\-|\*|/|==|!=|&lt;=|&gt;=</code></li>
<li>空白符：<code>\s+</code></li>
</ul>
<p><strong>把这些正则合成一个大正则</strong></p>
<p>方法是把所有正则“并”起来，用“选择” <code>|</code>，同时给每个正则打上“优先级标签”。</p>
<p>例如：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">R = (if)|(while)|(for)|([a-zA-Z_][a-zA-Z0-9_]*)|([0-9]+)|...</span><br></span></code></pre></div></div>
<p><strong>用 Thompson 构造法把正则转成 NFA</strong></p>
<p>对每个子正则单独建 NFA，然后用 ε 边连接在一起。</p>
<p><strong>用子集构造法把 NFA 转成 DFA</strong></p>
<p>这样你得到一个能识别<strong>所有 token</strong> 的大 DFA。</p>
<p><strong>DFA 最小化（可选）</strong></p>
<p>压缩状态数，提高效率。</p>
<p><strong>代码实现：DFA 驱动扫描器</strong></p>
<p>写一个循环，从输入流读字符：</p>
<ul>
<li>根据当前状态和字符查转移表</li>
<li>如果无路可走 → 回退，取最长匹配，输出 token</li>
<li>根据优先级解决冲突（比如 <code>if</code> 既能匹配关键字，也能匹配标识符）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="flex">Flex<a href="#flex" class="hash-link" aria-label="Direct link to Flex" title="Direct link to Flex">​</a></h3>
<p>Flex 是一个开源工具，用于根据用户定义的正则表达式规则，自动生成 C 或 C++ 语言的词法分析器（Lexer / Scanner）。
它读取一个 .l 或 .lex 后缀的源文件（称为“Flex 描述文件”），输出一个 lex.yy.c 文件 —— 这是一个标准的 C 程序，包含词法分析函数 yylex()。
通常与 Bison（语法分析器生成器，Yacc 的 GNU 版本）配合使用，构成经典的“Flex + Bison”编译器前端工具链。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="语法分析器">语法分析器<a href="#语法分析器" class="hash-link" aria-label="Direct link to 语法分析器" title="Direct link to 语法分析器">​</a></h2>
<p>本篇关键词：语法分析器（Parser）,上下文无关文法（CFG）,自顶向下,递归下降,抽象语法树（AST）
<em>斜体</em> 表示后文会展开的重要陌生概念</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="语法分析器-1">语法分析器<a href="#语法分析器-1" class="hash-link" aria-label="Direct link to 语法分析器" title="Direct link to 语法分析器">​</a></h3>
<p>s:
对于表达式 int sum = a + 42;
词法分析器给出的Token可能是
[ (KEYWORD, &quot;int&quot;),
(IDENTIFIER, &quot;sum&quot;),
(SYMBOL, &quot;=&quot;),
(IDENTIFIER, &quot;a&quot;),
(SYMBOL, &quot;+&quot;),
(NUMBER, 42),
(SYMBOL, &quot;;&quot;) ]
词法分析器接受这些Token，判断该Token 序列是否符合<em>上下文无关文法（CFG）</em>，并根据该序列构造<em>语法树</em>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="语法树与抽象语法树">语法树与抽象语法树<a href="#语法树与抽象语法树" class="hash-link" aria-label="Direct link to 语法树与抽象语法树" title="Direct link to 语法树与抽象语法树">​</a></h3>
<p>ChatGPT：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-语法树-parse-tree">1. 语法树 (Parse Tree)<a href="#1-语法树-parse-tree" class="hash-link" aria-label="Direct link to 1. 语法树 (Parse Tree)" title="Direct link to 1. 语法树 (Parse Tree)">​</a></h4>
<p><strong>定义：</strong>
语法树，也称为<strong>具体语法树</strong>（Concrete Syntax Tree, CST），是源代码根据其文法规则解析后生成的树形结构。它完整地反映了源代码的语法结构，包括了所有语法细节，比如括号、分号、关键字等。</p>
<p><strong>特点：</strong></p>
<ul>
<li><strong>保留所有语法细节</strong>：语法树的每个节点都对应文法中的一个产生式规则，叶子节点通常是终结符（如标识符、数字、操作符、括号等）。因此，它包含了源代码中所有的语法元素。</li>
<li><strong>与文法紧密相关</strong>：它的结构直接由语言的上下文无关文法（CFG）决定。不同的文法会产生不同的语法树。</li>
<li><strong>信息冗余</strong>：由于包含了所有语法符号（如 <code>;</code>, <code>{}</code>, <code>()</code> 等），语法树通常比较“臃肿”，包含了很多在后续处理中不必要的信息。</li>
<li><strong>用于语法分析验证</strong>：主要用于验证输入字符串是否符合语法规则。</li>
</ul>
<p><strong>示例：</strong>
对于表达式 <code>2 + 3 * 4</code>，假设文法如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Expr → Expr + Term | Term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Term → Term * Factor | Factor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Factor → number</span><br></span></code></pre></div></div>
<p>其语法树可能如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        Expr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       / | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Expr + Term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |     / | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Term  Term * Factor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |     |      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Factor Factor  4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2      3</span><br></span></code></pre></div></div>
<p>可以看到，树中包含了每一个非终结符（Expr, Term, Factor）和终结符（2, +, 3, *, 4）。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-抽象语法树-abstract-syntax-tree-ast">2. 抽象语法树 (Abstract Syntax Tree, AST)<a href="#2-抽象语法树-abstract-syntax-tree-ast" class="hash-link" aria-label="Direct link to 2. 抽象语法树 (Abstract Syntax Tree, AST)" title="Direct link to 2. 抽象语法树 (Abstract Syntax Tree, AST)">​</a></h4>
<p><strong>定义：</strong>
抽象语法树是语法树的简化版本。它去除了语法树中不重要的细节（如括号、分号、某些非终结符），只保留了程序结构的“本质”信息，更接近程序的逻辑结构。</p>
<p><strong>特点：</strong></p>
<ul>
<li><strong>抽象性高</strong>：省略了像括号、分号、<code>begin/end</code> 等不影响程序逻辑的语法符号。</li>
<li><strong>结构更简洁</strong>：节点数量更少，结构更清晰，便于后续处理。</li>
<li><strong>反映程序结构</strong>：更准确地表示了程序的层次结构和语义关系，例如表达式求值顺序、函数调用、变量声明等。</li>
<li><strong>用于语义分析与代码生成</strong>：是编译器进行类型检查、优化、代码生成等阶段的主要数据结构。</li>
<li><strong>独立于具体文法</strong>：多个不同的文法可以生成相同的AST，只要它们描述的是同一种语言结构。</li>
</ul>
<p><strong>示例：</strong>
对于同样的表达式 <code>2 + 3 * 4</code>，其AST可能如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      (+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     /   \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2    (*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /   \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       3     4</span><br></span></code></pre></div></div>
<p>这里：</p>
<ul>
<li><code>+</code> 和 <code>*</code> 是内部节点，表示加法和乘法操作。</li>
<li><code>2</code>, <code>3</code>, <code>4</code> 是叶子节点，表示操作数。</li>
<li>没有出现 <code>Expr</code>, <code>Term</code>, <code>Factor</code> 这样的中间非终结符，也没有括号。</li>
<li>树的结构自然地体现了运算优先级（<code>*</code> 在 <code>+</code> 的子树中，先计算）。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="上下文无关文法">上下文无关文法<a href="#上下文无关文法" class="hash-link" aria-label="Direct link to 上下文无关文法" title="Direct link to 上下文无关文法">​</a></h3>
<p>ChatGPT：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-一个上下文无关文法的例子">1. 一个上下文无关文法的例子<a href="#1-一个上下文无关文法的例子" class="hash-link" aria-label="Direct link to 1. 一个上下文无关文法的例子" title="Direct link to 1. 一个上下文无关文法的例子">​</a></h4>
<p>我们来看一个简单的文法，用来描述简单的算术表达式，比如 <code>a + a * a</code> 或 <code>a</code>。</p>
<p>这个文法由以下四个组成部分：</p>
<ul>
<li><strong>非终结符 (Non-terminals)</strong>：<code>E</code> （代表一个表达式）</li>
<li><strong>终结符 (Terminals)</strong>：<code>a</code>, <code>+</code>, <code>*</code></li>
<li><strong>起始符号 (Start symbol)</strong>：<code>E</code></li>
<li><strong>产生式规则 (Production rules)</strong>：<!-- -->
<ol>
<li><code>E -&gt; E + E</code></li>
<li><code>E -&gt; E * E</code></li>
<li><code>E -&gt; a</code></li>
</ol>
</li>
</ul>
<p>这个文法的意思是：</p>
<ul>
<li>一个表达式 <code>E</code> 可以是一个 <code>a</code>。</li>
<li>一个表达式 <code>E</code> 也可以是两个表达式 <code>E</code> 用 <code>+</code> 连接起来。</li>
<li>一个表达式 <code>E</code> 也可以是两个表达式 <code>E</code> 用 <code>*</code> 连接起来。</li>
</ul>
<p>例如，我们可以用这个文法推导出字符串 <code>a + a * a</code>：</p>
<ol>
<li><code>E</code> （起始）</li>
<li><code>E + E</code> （应用规则1）</li>
<li><code>E + E * E</code> （对第二个 <code>E</code> 应用规则2）</li>
<li><code>a + E * E</code> （对第一个 <code>E</code> 应用规则3）</li>
<li><code>a + a * E</code> （对第二个 <code>E</code> 应用规则3）</li>
<li><code>a + a * a</code> （对最后一个 <code>E</code> 应用规则3）</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-为什么叫上下文无关">2. 为什么叫“上下文无关”？<a href="#2-为什么叫上下文无关" class="hash-link" aria-label="Direct link to 2. 为什么叫“上下文无关”？" title="Direct link to 2. 为什么叫“上下文无关”？">​</a></h4>
<p>关键就在于“<strong>无关</strong>”这个词。我们来看产生式规则的<strong>形式</strong>。</p>
<p>在上面的文法中，每条规则都是这样的形式：</p>
<blockquote>
<p><strong>一个非终结符</strong> → <strong>一个符号串</strong></p>
</blockquote>
<p>具体来说：</p>
<ul>
<li><code>E -&gt; E + E</code></li>
<li><code>E -&gt; E * E</code></li>
<li><code>E -&gt; a</code></li>
</ul>
<p>注意，<strong>左边</strong>（箭头左边）<strong>总是且只能是一个单独的非终结符</strong>（在这个例子中是 <code>E</code>）。</p>
<p>这意味着，当我们在推导过程中看到一个 <code>E</code> 时，我们可以<strong>直接</strong>应用任何一条以 <code>E</code> 开头的规则来替换它。<strong>我们不需要关心这个 <code>E</code> 在什么位置，也不需要关心它周围是什么符号。</strong></p>
<ul>
<li>在字符串 <code>E + E</code> 中，第一个 <code>E</code> 可以被替换成 <code>a</code>，变成 <code>a + E</code>。</li>
<li>在字符串 <code>E * E</code> 中，第一个 <code>E</code> 也可以被替换成 <code>a</code>，变成 <code>a * E</code>。</li>
<li>在字符串 <code>( E )</code> 中（如果我们有括号的话），中间的 <code>E</code> 仍然可以被替换成 <code>a</code>，变成 <code>( a )</code>。</li>
</ul>
<p><strong>替换 <code>E</code> 的规则完全不依赖于 <code>E</code> 所处的“上下文”（即它前后的符号是什么）。</strong> 无论 <code>E</code> 是在开头、中间、结尾，还是被 <code>+</code>、<code>*</code> 或其他符号包围，我们都可以用相同的规则来替换它。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-对比上下文有关文法">3. 对比：上下文有关文法<a href="#3-对比上下文有关文法" class="hash-link" aria-label="Direct link to 3. 对比：上下文有关文法" title="Direct link to 3. 对比：上下文有关文法">​</a></h4>
<p>为了更好地理解“上下文无关”，我们可以想象一个“上下文有关”的情况。假设我们有一个规则：</p>
<blockquote>
<p><code>X E Y -&gt; X a Y</code></p>
</blockquote>
<p>这个规则的意思是：“只有当 <code>E</code> 的左边是 <code>X</code> 且右边是 <code>Y</code> 时，才能把 <code>E</code> 替换成 <code>a</code>”。</p>
<p>在这种情况下，能否替换 <code>E</code> <strong>完全取决于它的上下文</strong>（左边是 <code>X</code>，右边是 <code>Y</code>）。如果 <code>E</code> 的左边不是 <code>X</code> 或者右边不是 <code>Y</code>，这个规则就不能应用。</p>
<p>而上下文无关文法没有这种限制。规则 <code>E -&gt; a</code> 可以在任何地方应用，只要那里有一个 <code>E</code>。</p>
<blockquote>
<p>上下文无关文法（Context-Free Grammar, CFG）是由美国著名语言学家和认知科学家<strong>诺姆·乔姆斯基（Noam Chomsky）<strong>在20世纪50年代提出的。
<strong>诺姆·乔姆斯基 (Noam Chomsky)</strong> 是这一概念的提出者。他在1956年发表了一篇开创性的论文《<strong>Three Models for the Description of Language</strong>》（语言描述的三种模型），在这篇论文中，他系统地提出了</strong>形式语言的层级结构</strong>，后来被称为<strong>乔姆斯基层级（Chomsky Hierarchy）</strong>。
在这个层级中，他定义了四种类型的文法，其中第二类就是<strong>上下文无关文法（Type-2 Grammar）</strong>。他不仅定义了这种文法，还研究了它们的生成能力、与自动机（如下推自动机）的关系，为计算语言学和计算机科学奠定了坚实的理论基础。
乔姆斯基提出上下文无关文法主要受到以下几个方面的启发：
1.<strong>对自然语言结构的深入观察</strong>
乔姆斯基是一位语言学家，他不满意当时主流的行为主义语言学（如斯金纳的理论），认为语言不仅仅是“刺激-反应”的习惯，而是人类心智中一种<strong>内在的、创造性的规则系统</strong>。
他观察到：</p>
<ul>
<li>人类语言具有<strong>无限性</strong>：我们可以理解从未听过的句子。</li>
<li>语言具有<strong>层次化结构</strong>：句子不是单词的简单线性排列，而是有嵌套的短语结构（如“[The cat] [sat [on the mat]]”）。</li>
<li>语言具有<strong>递归性</strong>：一个结构可以包含同类型的子结构（如“他说她认为他错了”）。
他需要一种<strong>形式化的数学工具</strong>来精确描述这种复杂的、递归的、层次化的语言结构。上下文无关文法正是为此而设计的——它用简单的规则（如 <code>S → NP VP</code>）来捕捉句子的深层结构。
2.<strong>数学与逻辑的启发</strong>
乔姆斯基深受数学和逻辑学的影响。他将语言视为一种<strong>形式系统</strong>，类似于数学公理系统。他借鉴了：</li>
<li><strong>递归函数理论</strong>：描述如何通过有限规则生成无限对象。</li>
<li><strong>自动机理论</strong>：研究抽象计算机器的能力。
他试图用严格的数学框架来定义“语法”，并研究不同语法模型的<strong>生成能力</strong>和<strong>计算复杂度</strong>。上下文无关文法是他提出的四种模型之一，用于刻画比正则文法（Type-3）更复杂、但又比上下文有关文法（Type-1）更易处理的语言。
<strong>对早期形式语言研究的继承与发展</strong>
在他之前，已有学者（如逻辑学家 Emil Post）研究过形式文法和重写系统。乔姆斯基的工作是系统化和分类这些思想，并将其应用于<strong>自然语言</strong>的描述。他将文法从一种数学游戏提升为理解人类语言能力的核心工具。</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="根据cfg设计递归下降语法分析器">根据CFG设计递归下降语法分析器<a href="#根据cfg设计递归下降语法分析器" class="hash-link" aria-label="Direct link to 根据CFG设计递归下降语法分析器" title="Direct link to 根据CFG设计递归下降语法分析器">​</a></h3>
<p>s：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="对于abcd这个式子">对于a+b*(c+d)这个式子<a href="#对于abcd这个式子" class="hash-link" aria-label="Direct link to 对于a+b*(c+d)这个式子" title="Direct link to 对于a+b*(c+d)这个式子">​</a></h4>
<p><strong>使用以下文法</strong>：
E → E + T | T
T → T * F | F
F → ( E ) | id</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="首先我们使用上面的知识分析这个文法">首先我们使用上面的知识分析这个文法<a href="#首先我们使用上面的知识分析这个文法" class="hash-link" aria-label="Direct link to 首先我们使用上面的知识分析这个文法" title="Direct link to 首先我们使用上面的知识分析这个文法">​</a></h4>
<p><strong>文法定义</strong></p>
<ul>
<li><strong>非终结符 (Non-terminals)</strong>:<!-- -->
<ul>
<li><code>E</code>: 代表一个<strong>表达式 (Expression)</strong>。</li>
<li><code>T</code>: 代表一个<strong>项 (Term)</strong>。</li>
<li><code>F</code>: 代表一个<strong>因子 (Factor)</strong>。</li>
</ul>
</li>
<li><strong>终结符 (Terminals)</strong>:<!-- -->
<ul>
<li><code>+</code>, <code>*</code>: 加法和乘法运算符。</li>
<li><code>(</code>, <code>)</code>: 括号，用于改变运算优先级或分组。</li>
<li><code>id</code>: 代表“标识符”或“基本操作数”，可以理解为变量名（如 <code>a</code>, <code>x</code>, <code>count</code>）或常量（如 <code>5</code>, <code>3.14</code>）。在实际应用中，<code>id</code> 通常由词法分析器（lexer）从输入中识别出来。</li>
</ul>
</li>
<li><strong>起始符号</strong>: <code>E</code> (整个输入被认为是一个表达式)。</li>
</ul>
<p><strong>产生式规则详解</strong></p>
<ol>
<li><code>E → E + T | T</code> （表达式规则）</li>
</ol>
<p>这条规则定义了什么是“表达式”。</p>
<ul>
<li><strong><code>E → E + T</code></strong>: 一个表达式可以是一个<strong>表达式</strong>，后面跟着一个 <code>+</code> 号，再跟着一个<strong>项</strong>。<!-- -->
<ul>
<li><strong>作用</strong>：这允许表达式包含加法运算。</li>
<li><strong>结合性</strong>：因为 <code>E</code> 出现在左边（<code>E + T</code>），这表示加法是<strong>左结合</strong>的。例如，<code>a + b + c</code> 会被解释为 <code>(a + b) + c</code>，而不是 <code>a + (b + c)</code>（虽然数学上等价，但语法树结构不同）。</li>
</ul>
</li>
<li><strong><code>E → T</code></strong>: 一个表达式也可以直接是一个<strong>项</strong>。<!-- -->
<ul>
<li><strong>作用</strong>：这是递归的“基础情况”，防止无限递归。它表示一个简单的项（如 <code>a</code> 或 <code>a * b</code>）本身就是一个有效的表达式。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>关键点</strong>：这条规则将表达式分解为“表达式 + 项”，而不是“表达式 + 表达式”。这为 <code>+</code> 和 <code>*</code> 的优先级差异埋下了伏笔。</p>
</blockquote>
<ol start="2">
<li><code>T → T * F | F</code> （项规则）</li>
</ol>
<p>这条规则定义了什么是“项”。</p>
<ul>
<li><strong><code>T → T * F</code></strong>: 一个项可以是一个<strong>项</strong>，后面跟着一个 <code>*</code> 号，再跟着一个<strong>因子</strong>。<!-- -->
<ul>
<li><strong>作用</strong>：这允许项包含乘法运算。</li>
<li><strong>结合性</strong>：同样，因为 <code>T</code> 在左边，乘法也是<strong>左结合</strong>的。例如，<code>a * b * c</code> 会被解释为 <code>(a * b) * c</code>。</li>
</ul>
</li>
<li><strong><code>T → F</code></strong>: 一个项也可以直接是一个<strong>因子</strong>。<!-- -->
<ul>
<li><strong>作用</strong>：这是项的“基础情况”。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>关键点</strong>：乘法运算在 <code>T</code> 的规则中定义，而加法在 <code>E</code> 的规则中定义。<code>E</code> 可以包含 <code>T</code>，但 <code>T</code> 不能直接包含 <code>E</code>（除非通过 <code>F → ( E )</code>）。这种<strong>分层结构</strong>是实现优先级的核心。</p>
</blockquote>
<ol start="3">
<li><code>F → ( E ) | id</code> （因子规则）</li>
</ol>
<p>这条规则定义了什么是“因子”。</p>
<ul>
<li><strong><code>F → ( E )</code></strong>: 一个因子可以是一个用括号括起来的<strong>表达式</strong>。<!-- -->
<ul>
<li><strong>作用</strong>：这允许我们改变运算的优先级。括号内的表达式会被优先计算。</li>
<li><strong>递归性</strong>：<code>F</code> 内部又引用了 <code>E</code>，形成了递归，使得括号可以嵌套，如 <code>(a + (b * c))</code>。</li>
</ul>
</li>
<li><strong><code>F → id</code></strong>: 一个因子可以是一个基本的操作数，即 <code>id</code>。<!-- -->
<ul>
<li><strong>作用</strong>：这是语法的“叶子节点”，所有复杂表达式最终都由 <code>id</code> 构成。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>关键点</strong>：<code>id</code> 和括号表达式是构成表达式的最基本单元。</p>
</blockquote>
<p>这个文法通过<strong>非终结符的分层</strong>体现了优先级：</p>
<ol>
<li><strong>最高优先级</strong>：<code>id</code> 和 <code>( E )</code>（因子 <code>F</code>）</li>
<li><strong>中等优先级</strong>：<code>*</code>（在项 <code>T</code> 中定义）</li>
<li><strong>最低优先级</strong>：<code>+</code>（在表达式 <code>E</code> 中定义）</li>
</ol>
<p><strong>为什么 <code>*</code> 优先于 <code>+</code>？</strong></p>
<p>看这个表达式：<code>a + b * c</code></p>
<ul>
<li><code>b * c</code> 必须首先被识别为一个<strong>项 (T)</strong>，因为 <code>*</code> 只在 <code>T</code> 的规则中出现。</li>
<li>然后，<code>a</code> 是一个 <code>id</code>，所以它是一个 <code>F</code>，进而是一个 <code>T</code>。</li>
<li>最后，<code>a + (b * c)</code> 被识别为 <code>E + T</code>，即一个表达式。</li>
</ul>
<p>如果试图把 <code>a + b</code> 当作一个整体去乘 <code>c</code>，即 <code>(a + b) * c</code>，就必须用括号：<code>F → ( E )</code>，先让 <code>a + b</code> 成为一个 <code>E</code>，然后被括号包装成 <code>F</code>，再参与乘法。</p>
<p>此外还体现了<strong>结合性</strong></p>
<p>如前所述，<code>E → E + T</code> 和 <code>T → T * F</code> 都是<strong>左递归</strong>的（非终结符出现在产生式右边的最左边），这导致了<strong>左结合</strong>。</p>
<p>例如，<code>a + b + c</code> 的推导过程：</p>
<ol>
<li><code>E → E + T</code></li>
<li><code>→ (E + T) + T</code> （第一个 <code>E</code> 再次展开）</li>
<li><code>→ (T + T) + T</code> （<code>E → T</code>）</li>
<li><code>→ (id + id) + id</code></li>
</ol>
<p>这对应于 <code>(a + b) + c</code>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="接着通过类似parser的伪代码了解parse过程">接着通过类似Parser的伪代码了解parse过程<a href="#接着通过类似parser的伪代码了解parse过程" class="hash-link" aria-label="Direct link to 接着通过类似Parser的伪代码了解parse过程" title="Direct link to 接着通过类似Parser的伪代码了解parse过程">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_E</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parse_T</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> peek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;PLUS&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;PLUS&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parse_T</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;binop&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;+&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_T</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parse_F</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> peek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;TIMES&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;TIMES&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        right </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parse_F</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        left </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;binop&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;*&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> left</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> right</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> left</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_F</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> peek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ID&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tok </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;ID&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;id&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tok</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> peek</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;LPAREN&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;LPAREN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> parse_E</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        consume</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;RPAREN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">raise</span><span class="token plain"> SyntaxError</span><br></span></code></pre></div></div>
<p>语法分析器分析经过了以下步骤</p>
<ol>
<li>
<p><code>parse_E()</code> called
→ 调用 <code>parse_T()</code></p>
</li>
<li>
<p><code>parse_T()</code> called
→ 调用 <code>parse_F()</code></p>
</li>
<li>
<p><code>parse_F()</code> 看到 <code>ID &quot;a&quot;</code>，consume，返回 <code>(&#x27;id&#x27;,&#x27;a&#x27;)</code>
<code>parse_T()</code>：下一个 token 不是 <code>*</code>，所以返回 <code>left=(&#x27;id&#x27;,&#x27;a&#x27;)</code></p>
</li>
<li>
<p><code>parse_E()</code>：看到 <code>PLUS</code>，consume <code>+</code>，准备解析右侧 → 调用 <code>parse_T()</code>（解析 <code>b * (c + d)</code>）</p>
</li>
<li>
<p>新的 <code>parse_T()</code> 调用 <code>parse_F()</code>: 看到 <code>ID &quot;b&quot;</code> → 返回 <code>(&#x27;id&#x27;,&#x27;b&#x27;)</code></p>
<ul>
<li><code>parse_T()</code> 看到下一个是 <code>TIMES</code>，consume <code>*</code>，继续 <code>parse_F()</code></li>
</ul>
</li>
<li>
<p><code>parse_F()</code> 看到 <code>LPAREN</code>，consume <code>(</code>，调用 <code>parse_E()</code> 解析括号内 <code>c + d</code></p>
<ul>
<li>递 <code>parse_E()</code> → <code>parse_T()</code> → <code>parse_F()</code> 返回 <code>(&#x27;id&#x27;,&#x27;c&#x27;)</code></li>
<li><code>parse_E()</code> 看到 <code>PLUS</code>，consume <code>+</code>，右侧 <code>parse_T()</code> 返回 <code>(&#x27;id&#x27;,&#x27;d&#x27;)</code></li>
<li><code>parse_E()</code> 在 <code>+</code> 的循环里把左右合并： <code>(&#x27;binop&#x27;, &#x27;+&#x27;, (&#x27;id&#x27;,&#x27;c&#x27;), (&#x27;id&#x27;,&#x27;d&#x27;))</code>，遇到 <code>RPAREN</code> 停止，<code>parse_E()</code> 返回该节点。</li>
</ul>
</li>
<li>
<p><code>parse_F()</code>（括号） consume <code>)</code>，并返回子表达式节点 <code>(&#x27;binop&#x27;, &#x27;+&#x27;, c, d)</code></p>
</li>
<li>
<p><code>parse_T()</code> 在 <code>*</code> 的循环里把左 <code>(&#x27;id&#x27;,&#x27;b&#x27;)</code> 和右 <code>(&#x27;binop&#x27;,&#x27;+&#x27;,c,d)</code> 合并成 <code>(&#x27;binop&#x27;,&#x27;*&#x27;, (&#x27;id&#x27;,&#x27;b&#x27;), (&#x27;binop&#x27;,&#x27;+&#x27;,c,d))</code>，返回该节点。</p>
</li>
<li>
<p>最后外层 <code>parse_E()</code> 把 <code>(&#x27;id&#x27;,&#x27;a&#x27;)</code> 和上面乘法节点用 <code>+</code> 合并，得到最终 AST：
<code>(&#x27;binop&#x27;,&#x27;+&#x27;, (&#x27;id&#x27;,&#x27;a&#x27;), (&#x27;binop&#x27;,&#x27;*&#x27;, (&#x27;id&#x27;,&#x27;b&#x27;), (&#x27;binop&#x27;,&#x27;+&#x27;, (&#x27;id&#x27;,&#x27;c&#x27;), (&#x27;id&#x27;,&#x27;d&#x27;))))</code></p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="为什么这段伪代码要这么设计">为什么这段伪代码要这么设计？<a href="#为什么这段伪代码要这么设计" class="hash-link" aria-label="Direct link to 为什么这段伪代码要这么设计？" title="Direct link to 为什么这段伪代码要这么设计？">​</a></h4>
<p>E → E + T | T
看到这样的文法，我们的第一思路可能是</p>
<div class="language-py codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-py codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_E</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parse_E</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ← 直接调用自己，无限递归！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;+&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parse_T</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>然而这段代码无限循环了
这是因为这样的文法存在<strong>左递归</strong></p>
<p>为了避免这种情况，我们可以像上述伪代码那样用while循环模拟左递归
但更常用的方法是：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="消除直接左递归的通用方法">消除直接左递归的通用方法<a href="#消除直接左递归的通用方法" class="hash-link" aria-label="Direct link to 消除直接左递归的通用方法" title="Direct link to 消除直接左递归的通用方法">​</a></h4>
<p>对于形如：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A → Aα | β</span><br></span></code></pre></div></div>
<p>（其中 <code>β</code> 是不以 <code>A</code> 开头的产生式）</p>
<p>我们可以将其改写为：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A  → β A&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A&#x27; → α A&#x27; | ε</span><br></span></code></pre></div></div>
<p>例如</p>
<p>原规则：</p>
<p>E → E + T | T
这里 α = + T, β = T</p>
<p>消除左递归后：</p>
<p>E  → T E&#x27;
E&#x27; → + T E&#x27; | ε</p>
<p>由此写出代码即可避免无限循环并保留左结合的特性</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主流编译器的语法分析器">主流编译器的语法分析器<a href="#主流编译器的语法分析器" class="hash-link" aria-label="Direct link to 主流编译器的语法分析器" title="Direct link to 主流编译器的语法分析器">​</a></h3>
<p>ChatGPT:</p>
<table><thead><tr><th>编译器</th><th>语法分析器类型</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>gcc</strong></td><td>Bison 生成的 LALR(1)(自底向上的分析方法)</td><td>自动化程度高，适合传统 C</td><td>对复杂语法（C++）扩展性差，维护难</td></tr><tr><td><strong>clang</strong></td><td>手写递归下降（LL 风格）</td><td>灵活，代码结构清晰，适合复杂语法（C++、Objective-C）</td><td>写起来更繁琐，容易出 bug</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bison">Bison<a href="#bison" class="hash-link" aria-label="Direct link to Bison" title="Direct link to Bison">​</a></h3>
<p>Bison 读取一个以 .y 或 .yy 为后缀的语法规则文件，自动生成一个语法分析器（Parser）的 C/C++ 代码（通常是 y.tab.c 和 y.tab.h）。
它根据你定义的上下文无关文法（CFG, Context-Free Grammar），构建一个LALR(1)（或可选 LR(1)、GLR）语法分析表，并生成相应的分析函数 yyparse()。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="手写计算器">手写计算器<a href="#手写计算器" class="hash-link" aria-label="Direct link to 手写计算器" title="Direct link to 手写计算器">​</a></h2>
<p>我打算先自己手写一个计算器，体会一下
在简单了解了逆波兰式后我有了这样的思路
用两个栈，一个存放数字，一个存放运算符，通过栈的性质实现优先级
这样的计算器实现了整数负数小数以及三角函数的加减乘除运算，且能正确处理运算优先级
然而处理思路和编译器中的可能相差甚远
我想把这一段删掉，但有点不舍，最终保留</p>
<p>代码如下</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;ctype.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;string.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;math.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">StackConstuct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sizeOfElement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Stack </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pStack</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pStack</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">==</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;construct1 error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">STACK_INIT_SIZE</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sizeOfElement</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token operator" style="color:#393A34">==</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;construct2 error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">sizeOfElement</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">STACK_INIT_SIZE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> pStack</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">StackDestruct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">==</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;detruct error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">free</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status </span><span class="token function" style="color:#d73a49">StackPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">void</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pElem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop</span><span class="token operator" style="color:#393A34">==</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;pop error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pc</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pc</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pElem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> OK</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pElem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Stack pointer is NULL, push error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">newBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">realloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> STACK_INCREMENT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newBase </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Memory allocation failed during push for empty stack or stack resize, push error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newBase</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> STACK_INCREMENT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">newBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">realloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> STACK_INCREMENT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newBase </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newBase</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">stackSize </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> STACK_INCREMENT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pElem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> OK</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status </span><span class="token function" style="color:#d73a49">GetTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pElem</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;gettop error\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">topAddr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pElem</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> topAddr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">elementSize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> OK</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bool </span><span class="token function" style="color:#d73a49">IsEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pTop </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> pStack</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status </span><span class="token function" style="color:#d73a49">Calculate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">double</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">IsLegal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Stack </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pNumberStack</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">StackConstuct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Stack </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pOperatorStack</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">StackConstuct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> bottomOfOpeStack</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;#&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">bottomOfOpeStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">AddZero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">ProcessExpression</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">GetTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackDestruct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackDestruct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> OK</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ERROR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bool </span><span class="token function" style="color:#d73a49">IsLegal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isdigit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;+&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;-&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;*&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;/&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;(&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> c </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;)&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">strncmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tan&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">||</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">isalnum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">strncmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">||</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">isalnum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">strncmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;cos&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">||</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">isalnum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isdigit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> FALSE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> FALSE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> TRUE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AddZero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;(&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;+&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;-&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;*&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token char">&#x27;0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                len</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProcessExpression</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> numBuffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> numBufferIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isdigit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            numBuffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">numBufferIndex</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">isdigit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                numBuffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">numBufferIndex</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            numBuffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">numBufferIndex</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">atof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">numBuffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;push number %lf\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            numBufferIndex </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> op </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;)&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> flag</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flag</span><span class="token operator" style="color:#393A34">!=</span><span class="token char">&#x27;(&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flag</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;#&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">CalUnary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">GetTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Now flag is %c\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">flag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;endless loop in )\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flag</span><span class="token operator" style="color:#393A34">!=</span><span class="token char">&#x27;#&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> bin</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">StackPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">bin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;s&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;c&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;t&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">ProcessTri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;i here is%d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;(&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;push operator %c  expect(\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;+&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;-&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;*&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> op</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> OperatorTop</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> topPri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> OpePri</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">GetTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">OperatorTop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                OpePri</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">GetPriority</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                topPri</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">GetPriority</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OperatorTop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">OpePri</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">topPri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;push operator %c\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">CalUnary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;push operator %c\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Error.\nIllegal input for %c.\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Reading has done.All the element have been pushed into stack\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> sign</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">GetTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sign</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sign</span><span class="token operator" style="color:#393A34">!=</span><span class="token char">&#x27;#&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">CalUnary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">GetTop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sign</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count </span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Now sign is:%c\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">sign</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;endless loop in while\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Processing has done.Waiting for output\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetPriority</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> Operator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Operator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;+&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;-&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;*&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;/&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;#&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CalUnary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pOperatorStack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> a</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> tempOperator</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;.&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> b</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> tempresult</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pOperatorStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">tempOperator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackPop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tempOperator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;+&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tempresult</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;-&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tempresult</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;*&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tempresult</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;/&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Error.\nDevived by zero.\n1/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tempresult</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">a</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;(&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tempresult</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">tempresult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Perform a unary operation.tempresult=%lf,temoperator=%c\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">tempresult</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">tempOperator</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ProcessTri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Stack</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">int</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> beginning</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> len </span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> count</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> paraflag</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">beginning</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;i in tri is %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> end</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> triExpression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_LENGHTH</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> j</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">len</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;(&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    count</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    paraflag</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token char">&#x27;)&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    count</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        triExpression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> paraflag</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            triExpression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">j</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;j==%d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            end</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">j</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">beginning</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;end here is %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;beginning here is %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">beginning</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> pararesult</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Calculate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">triExpression</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pararesult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> result</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expression</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;t&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">tan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pararesult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;s&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">sin</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pararesult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token char">&#x27;c&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        result</span><span class="token operator" style="color:#393A34">=</span><span class="token function" style="color:#d73a49">cos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pararesult</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;result in Tri:%lf\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">StackPush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pNumberStack</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">if</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">DEBUG</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tri push is OK,result=%lf\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="使用flex和bison实现计算器">使用Flex和Bison实现计算器<a href="#使用flex和bison实现计算器" class="hash-link" aria-label="Direct link to 使用Flex和Bison实现计算器" title="Direct link to 使用Flex和Bison实现计算器">​</a></h2>
<p>我打算从简单的做起，先在ai的帮助下做一个只支持两个整数相加的计算器，借助这个熟悉流程和语法
然后再自己独立做一个更完善的计算器</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="只支持两位加法">只支持两位加法<a href="#只支持两位加法" class="hash-link" aria-label="Direct link to 只支持两位加法" title="Direct link to 只支持两位加法">​</a></h3>
<p>在linux环境下
首先编写add.l</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;add.tab.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0-9]+      { yylval = atoi(yytext); return NUMBER; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;+&quot;         { return &#x27;+&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\n          { return &#x27;\n&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ \t]       { /* 忽略空格 */ }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span></code></pre></div></div>
<p>然后编写add.y</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yylex(void);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yyerror(char *s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%token NUMBER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expr &#x27;\n&#x27;   { printf(&quot;= %d\n&quot;, $1);YYACCEPT; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      NUMBER &#x27;+&#x27; NUMBER   { $$ = $1 + $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(void) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return yyparse();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yyerror(char *s) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fprintf(stderr, &quot;Error: %s\n&quot;, s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>在add.l中：</strong></p>
<p>其中 add.tab.h 是之后用bison生成的，看了一下
其中有：
token 的枚举（NUMBER ）</p>
<p>yylval 的类型（默认是 int）</p>
<p>语法分析器的入口函数 yyparse()</p>
<p>剩下的一些我现在看不懂的宏</p>
<p>底下的语法规则是识别一个或多个数字，用atoi函数把字符串转换成int，再把这个整数传给yylval</p>
<p>[ \t]       <!-- -->
表示匹配空格和tab <!-- -->里什么都不做，相当于跳过去了</p>
<p><strong>在add.y中</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yylex(void);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yyerror(char *s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%}</span><br></span></code></pre></div></div>
<p>这一部分会原封不动地搬到add.tab.c中，写上必要的头文件，支持printf,atoi等函数</p>
<p>%token NUMBER
声明NUMBER词法符号</p>
<p>下面是语法规则部分，类似于CFG的产生式
后面跟着这个式子reduce之后进行的动作
比如：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expr &#x27;\n&#x27;   { printf(&quot;= %d\n&quot;, $1); YYACCEPT;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>在该规则被reduce时，打印expr的值，并且结束解析</p>
<p>然后用以下命令生成add目标文件</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bison -d add.y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flex add.l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc -o add add.tab.c lex.yy.c -lfl</span><br></span></code></pre></div></div>
<p>成功，程序可以接受:1+1[回车]
返回:=2</p>
<p>我尝试在ai的帮助下阅读flex和bison生成的C语言源文件</p>
<p>然而我没想到这么简单的运算最后生成的代码竟然这么多，我也看不太懂，只能是ai说什么就认为是什么了</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="四则运算括号优先级的计算器">四则运算括号优先级的计算器<a href="#四则运算括号优先级的计算器" class="hash-link" aria-label="Direct link to 四则运算括号优先级的计算器" title="Direct link to 四则运算括号优先级的计算器">​</a></h3>
<p>接下来我要给计算器做以下拓展：
1.支持多个整数的运算
2.支持减乘除
3.支持括号
4.正确处理优先级</p>
<p>首先 在.l文件中加入</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;-&quot;         {return  &#x27;-&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.           { return yytext[0]; } </span><br></span></code></pre></div></div>
<p>支持减号
用.接受* /()，返回接收到的第一个字符
同时将.y中的产生式结构改为三层</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">expr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expr &#x27;+&#x27; term { $$ = $1 + $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr &#x27;-&#x27; term { $$ = $1 - $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | term { $$ = $1; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">term:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    term &#x27;*&#x27; factor { $$ = $1 * $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | term &#x27;/&#x27; factor { $$ = $1 / $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | factor { $$ = $1; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;(&#x27; expr &#x27;)&#x27; { $$ = $2; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | NUMBER { $$ = $1; }</span><br></span></code></pre></div></div>
<p>在factor层实现括号的计算，从而将括号设置为最高优先级
同理term层实现+-</p>
<p>编译
经过测试，程序完整的实现了上述功能</p>
<p>这个计算器还有一些不足
1.不能正确处理负数
2.不能正确处理小数</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="支持负数的计算器">支持负数的计算器<a href="#支持负数的计算器" class="hash-link" aria-label="Direct link to 支持负数的计算器" title="Direct link to 支持负数的计算器">​</a></h3>
<p>经过思考，我意识到 作为负数的-号
1.优先级比+-*/更高（在C语言中-2*-3是合法的，结果为6）
2.优先级比括号更低，-(2+3)=-5 （这种说法似乎不准确，应该是-和（相遇时先把（里的看作一个整体）
因此我在</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">factor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;(&#x27; expr &#x27;)&#x27; { $$ = $2; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | NUMBER { $$ = $1; }</span><br></span></code></pre></div></div>
<p>中直接加入</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| &#x27;-&#x27; factor          { $$ = -$2; }</span><br></span></code></pre></div></div>
<p>从而正确处理</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="支持小数的计算器">支持小数的计算器<a href="#支持小数的计算器" class="hash-link" aria-label="Direct link to 支持小数的计算器" title="Direct link to 支持小数的计算器">​</a></h3>
<p>我觉得首先.l文件中的数字识别部分要改，改成支持小数输入的正则，同时不能再使用atoi函数</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[0-9]+(\.[0-9]+)?   { yylval.val = atof(yytext); return NUMBER; } </span><br></span></code></pre></div></div>
<p>这里yylval由int变成了联合体其中包含了double val ，所以要改为yylval.val</p>
<p>其次是NUMBER要识别成double
然而具体改的时候我有点无从下手
在ai的帮助下
我进行了以下修改：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%union {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%token &lt;val&gt; NUMBER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%type  &lt;val&gt; expr term factor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span></code></pre></div></div>
<p>联合体定义了所有之后可能用到的类型</p>
<p>接下来再用</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;val\&gt;</span><br></span></code></pre></div></div>
<p>定义终结符和非终结符的类型
最后把printf改过来</p>
<p>最后的程序成功地通过了检验</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="最终版本的计算器">最终版本的计算器<a href="#最终版本的计算器" class="hash-link" aria-label="Direct link to 最终版本的计算器" title="Direct link to 最终版本的计算器">​</a></h2>
<p>cal.l</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;calculator.tab.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0-9]+(\.[0-9]+)?   { yylval.val= atof(yytext); return NUMBER; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;++&quot;        { return INCR; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&amp;*&quot;        { return ANDMUL; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;|*&quot;        { return ORMUL; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&amp;&quot;         { return &#x27;&amp;&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;|&quot;         { return &#x27;|&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;^&quot;         { return &#x27;^&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&lt;&lt;&quot;        { return LSHIFT; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&gt;&gt;&quot;        { return RSHIFT; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;+&quot;         { return &#x27;+&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;-&quot;         { return &#x27;-&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;*&quot;         { return &#x27;*&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;/&quot;         { return &#x27;/&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;(&quot;         { return &#x27;(&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;)&quot;         { return &#x27;)&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\n          { return &#x27;\n&#x27;; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ \t]       {  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.           { return yytext[0]; }  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>cal.y</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">%{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;math.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yylex(void);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yyerror(char *s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%union {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%token &lt;val&gt; NUMBER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%token INCR ANDMUL ORMUL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%token LSHIFT RSHIFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%type  &lt;val&gt; expr term factor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left &#x27;|&#x27; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left &#x27;^&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left &#x27;&amp;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left LSHIFT RSHIFT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left &#x27;+&#x27; &#x27;-&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left &#x27;*&#x27; &#x27;/&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%left INCR ANDMUL ORMUL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%right UMINUS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      expr &#x27;\n&#x27;   { printf(&quot;= %lf\n&quot;, $1); YYACCEPT;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expr:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expr &#x27;+&#x27; term       { $$ = $1 + $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr &#x27;-&#x27; term       { $$ = $1 - $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr &#x27;|&#x27; term       { $$ = (long)$1 | (long)$3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr &#x27;^&#x27; term       { $$ = (long)$1 ^ (long)$3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr &#x27;&amp;&#x27; term       { $$ = (long)$1 &amp; (long)$3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr LSHIFT term    { $$ = (long)$1 &lt;&lt; (long)$3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr RSHIFT term    { $$ = (long)$1 &gt;&gt; (long)$3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr INCR term      { $$ = $1 + ($3 + 1); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr ANDMUL term    { $$ = ((long)$1 &amp; (long)$3) * $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | expr ORMUL term     { $$ = ((long)$1 | (long)$3) * $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | term                { $$ = $1; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">term:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    term &#x27;*&#x27; factor { $$ = $1 * $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | term &#x27;/&#x27; factor { $$ = $1 / $3; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | factor          { $$ = $1; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">factor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;(&#x27; expr &#x27;)&#x27; { $$ = $2; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | NUMBER       { $$ = $1; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | &#x27;-&#x27; factor   %prec UMINUS { $$ = -$2; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">%%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(void) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return yyparse();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int yyerror(char *s) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fprintf(stderr, &quot;Error: %s\n&quot;, s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>这个计算器：
支持浮点运算
在处理位运算将浮点强制转换成long
支持 (a ++ b) ::= a + (b + 1)
(a &amp;* b) ::= (a &amp; b) * b
(a |* b) ::= (a | b) * b
使用%prec UMINUS和%right UMINUS保证-号的正确性</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/compiler/Notes/Jotang2025_8/Task1.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Koki-s-Blog/docs/compiler/Notes/Jotang2025_8/Task0"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Task0</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Koki-s-Blog/docs/compiler/Class/ClassIntro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ClassIntro</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#词法分析器" class="table-of-contents__link toc-highlight">词法分析器</a><ul><li><a href="#正则表达式" class="table-of-contents__link toc-highlight">正则表达式</a></li><li><a href="#有限自动机" class="table-of-contents__link toc-highlight">有限自动机</a></li><li><a href="#flex" class="table-of-contents__link toc-highlight">Flex</a></li></ul></li><li><a href="#语法分析器" class="table-of-contents__link toc-highlight">语法分析器</a><ul><li><a href="#语法分析器-1" class="table-of-contents__link toc-highlight">语法分析器</a></li><li><a href="#语法树与抽象语法树" class="table-of-contents__link toc-highlight">语法树与抽象语法树</a></li><li><a href="#上下文无关文法" class="table-of-contents__link toc-highlight">上下文无关文法</a></li><li><a href="#根据cfg设计递归下降语法分析器" class="table-of-contents__link toc-highlight">根据CFG设计递归下降语法分析器</a></li><li><a href="#主流编译器的语法分析器" class="table-of-contents__link toc-highlight">主流编译器的语法分析器</a></li><li><a href="#bison" class="table-of-contents__link toc-highlight">Bison</a></li></ul></li><li><a href="#手写计算器" class="table-of-contents__link toc-highlight">手写计算器</a></li><li><a href="#使用flex和bison实现计算器" class="table-of-contents__link toc-highlight">使用Flex和Bison实现计算器</a><ul><li><a href="#只支持两位加法" class="table-of-contents__link toc-highlight">只支持两位加法</a></li><li><a href="#四则运算括号优先级的计算器" class="table-of-contents__link toc-highlight">四则运算括号优先级的计算器</a></li><li><a href="#支持负数的计算器" class="table-of-contents__link toc-highlight">支持负数的计算器</a></li><li><a href="#支持小数的计算器" class="table-of-contents__link toc-highlight">支持小数的计算器</a></li></ul></li><li><a href="#最终版本的计算器" class="table-of-contents__link toc-highlight">最终版本的计算器</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Koki-s-Blog/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Koki-s-Blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>